import{_ as oe,o as ne,c as U,a as y,b as w,e as t,w as a,r,g as u,y as R,E as b,A as re,i as m,q as se,F as N,h as S,B as ie,f as F,t as K,z as ue}from"./index-DdQYDSmE.js";import{k as A}from"./knowledge-bw-FKdSZ.js";const de={class:"admin-articles-container"},pe={class:"page-header"},me={class:"pagination-wrap"},ce={__name:"AdminArticles",setup(ge){const $=["慢性病管理","饮食营养","心理健康","运动健身","老年健康","儿童健康"],T=u(!1),D=u(!1),h=u(1),z=u(10),I=u(0),L=u([]),d=R({keyword:"",category:"",sortBy:"latest"}),c=u(!1),V=u(!1),k=u(null),E=u(),o=R({title:"",category:"",summary:"",content:"",cover_image:"",tagsText:""}),j={title:[{required:!0,message:"请输入标题",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],summary:[{required:!0,message:"请输入摘要",trigger:"blur"}],content:[{required:!0,message:"请输入正文",trigger:"blur"}]},G=n=>n.split(",").map(e=>e.trim()).filter(Boolean),g=async()=>{var n,e;T.value=!0;try{const s=await A.getArticles({page:h.value,page_size:z.value,category:d.category||void 0,keyword:d.keyword||void 0,sort_by:d.sortBy});L.value=s.items||[],I.value=s.total||0}catch(s){b.error(((e=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:e.detail)||"加载文章失败")}finally{T.value=!1}},H=()=>{o.title="",o.category="",o.summary="",o.content="",o.cover_image="",o.tagsText="",k.value=null},J=()=>{V.value=!1,H(),c.value=!0},O=n=>{V.value=!0,k.value=n.id,o.title=n.title,o.category=n.category,o.summary=n.summary||"",o.content=n.content,o.cover_image=n.cover_image||"",o.tagsText=(n.tags||[]).join(","),c.value=!0},Q=async()=>{var s,x;if(!E.value||!await E.value.validate().catch(()=>!1))return;const e={title:o.title,category:o.category,summary:o.summary,content:o.content,cover_image:o.cover_image||null,tags:G(o.tagsText)};D.value=!0;try{V.value&&k.value?(await A.updateArticle(k.value,e),b.success("文章已更新")):(await A.createArticle(e),b.success("文章已创建")),c.value=!1,await g()}catch(i){b.error(((x=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:x.detail)||"保存失败")}finally{D.value=!1}},W=async n=>{try{await ue.confirm(`确认删除文章《${n.title}》？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await A.deleteArticle(n.id),b.success("删除成功"),await g()}catch{}},X=n=>n?new Date(n).toLocaleString("zh-CN",{hour12:!1}):"-";return ne(g),(n,e)=>{const s=r("Plus"),x=r("el-icon"),i=r("el-button"),f=r("el-input"),_=r("el-col"),C=r("el-option"),q=r("el-select"),M=r("el-row"),P=r("el-card"),p=r("el-table-column"),Y=r("el-tag"),Z=r("el-table"),ee=r("el-pagination"),v=r("el-form-item"),te=r("el-form"),le=r("el-dialog"),ae=re("loading");return y(),U("div",de,[w("div",pe,[e[14]||(e[14]=w("div",null,[w("h1",null,"文章管理"),w("p",null,"创建、编辑和删除健康科普文章")],-1)),t(i,{type:"primary",onClick:J},{default:a(()=>[t(x,null,{default:a(()=>[t(s)]),_:1}),e[13]||(e[13]=m(" 新建文章 ",-1))]),_:1})]),t(P,{shadow:"hover",class:"filter-card"},{default:a(()=>[t(M,{gutter:12},{default:a(()=>[t(_,{span:8},{default:a(()=>[t(f,{modelValue:d.keyword,"onUpdate:modelValue":e[0]||(e[0]=l=>d.keyword=l),placeholder:"按标题/摘要搜索",clearable:"",onKeyup:se(g,["enter"])},null,8,["modelValue"])]),_:1}),t(_,{span:6},{default:a(()=>[t(q,{modelValue:d.category,"onUpdate:modelValue":e[1]||(e[1]=l=>d.category=l),placeholder:"分类",clearable:"",style:{width:"100%"}},{default:a(()=>[(y(),U(N,null,S($,l=>t(C,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(_,{span:6},{default:a(()=>[t(q,{modelValue:d.sortBy,"onUpdate:modelValue":e[2]||(e[2]=l=>d.sortBy=l),style:{width:"100%"}},{default:a(()=>[t(C,{label:"最新发布",value:"latest"}),t(C,{label:"热门浏览",value:"hot"})]),_:1},8,["modelValue"])]),_:1}),t(_,{span:4,class:"filter-actions"},{default:a(()=>[t(i,{type:"primary",onClick:g},{default:a(()=>[...e[15]||(e[15]=[m("查询",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),t(P,{shadow:"hover"},{default:a(()=>[ie((y(),F(Z,{data:L.value,stripe:""},{default:a(()=>[t(p,{prop:"id",label:"ID",width:"70"}),t(p,{prop:"title",label:"标题","min-width":"220"}),t(p,{prop:"category",label:"分类",width:"130"}),t(p,{label:"标签","min-width":"180"},{default:a(({row:l})=>[(y(!0),U(N,null,S(l.tags,B=>(y(),F(Y,{key:B,size:"small",class:"tag-item"},{default:a(()=>[m(K(B),1)]),_:2},1024))),128))]),_:1}),t(p,{prop:"view_count",label:"浏览",width:"90"}),t(p,{prop:"favorite_count",label:"收藏",width:"90"}),t(p,{label:"创建时间",width:"170"},{default:a(({row:l})=>[m(K(X(l.created_at)),1)]),_:1}),t(p,{label:"操作",width:"180",fixed:"right"},{default:a(({row:l})=>[t(i,{type:"primary",link:"",onClick:B=>O(l)},{default:a(()=>[...e[16]||(e[16]=[m("编辑",-1)])]),_:1},8,["onClick"]),t(i,{type:"danger",link:"",onClick:B=>W(l)},{default:a(()=>[...e[17]||(e[17]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,T.value]]),w("div",me,[t(ee,{"current-page":h.value,"onUpdate:currentPage":e[3]||(e[3]=l=>h.value=l),"page-size":z.value,"onUpdate:pageSize":e[4]||(e[4]=l=>z.value=l),total:I.value,layout:"total, prev, pager, next",onCurrentChange:g},null,8,["current-page","page-size","total"])])]),_:1}),t(le,{modelValue:c.value,"onUpdate:modelValue":e[12]||(e[12]=l=>c.value=l),title:V.value?"编辑文章":"新建文章",width:"760px"},{footer:a(()=>[t(i,{onClick:e[11]||(e[11]=l=>c.value=!1)},{default:a(()=>[...e[18]||(e[18]=[m("取消",-1)])]),_:1}),t(i,{type:"primary",loading:D.value,onClick:Q},{default:a(()=>[...e[19]||(e[19]=[m("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(te,{ref_key:"editorRef",ref:E,model:o,rules:j,"label-position":"top"},{default:a(()=>[t(M,{gutter:12},{default:a(()=>[t(_,{span:14},{default:a(()=>[t(v,{label:"标题",prop:"title"},{default:a(()=>[t(f,{modelValue:o.title,"onUpdate:modelValue":e[5]||(e[5]=l=>o.title=l),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{span:10},{default:a(()=>[t(v,{label:"分类",prop:"category"},{default:a(()=>[t(q,{modelValue:o.category,"onUpdate:modelValue":e[6]||(e[6]=l=>o.category=l),style:{width:"100%"},placeholder:"请选择分类"},{default:a(()=>[(y(),U(N,null,S($,l=>t(C,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(v,{label:"摘要",prop:"summary"},{default:a(()=>[t(f,{modelValue:o.summary,"onUpdate:modelValue":e[7]||(e[7]=l=>o.summary=l),type:"textarea",rows:2,maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(v,{label:"封面图URL"},{default:a(()=>[t(f,{modelValue:o.cover_image,"onUpdate:modelValue":e[8]||(e[8]=l=>o.cover_image=l),placeholder:"https://..."},null,8,["modelValue"])]),_:1}),t(v,{label:"标签（英文逗号分隔）"},{default:a(()=>[t(f,{modelValue:o.tagsText,"onUpdate:modelValue":e[9]||(e[9]=l=>o.tagsText=l),placeholder:"例如：血压,控盐,中老年"},null,8,["modelValue"])]),_:1}),t(v,{label:"正文",prop:"content"},{default:a(()=>[t(f,{modelValue:o.content,"onUpdate:modelValue":e[10]||(e[10]=l=>o.content=l),type:"textarea",rows:10,maxlength:"20000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ve=oe(ce,[["__scopeId","data-v-d12e331a"]]);export{ve as default};
