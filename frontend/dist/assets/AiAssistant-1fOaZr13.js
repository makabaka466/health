import{m as L,_ as U,o as q,c as m,a as d,b as e,e as o,w as l,r as v,F,h as S,g as p,p as K,q as j,s as O,E as b,v as Q,i as f,n as E,t as w,f as $}from"./index-BGGP1xAb.js";const G="http://127.0.0.1:8000/api",_=L.create({baseURL:G,timeout:3e4});_.interceptors.request.use(s=>{const a=localStorage.getItem("token");return a&&(s.headers.Authorization=`Bearer ${a}`),s},s=>Promise.reject(s));_.interceptors.response.use(s=>s.data,s=>{var a;return((a=s.response)==null?void 0:a.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("userRole"),window.location.href="/login"),Promise.reject(s)});const D={async sendMessage(s){const{data:a}=await _.post("/ai/chat",s);return a},async getChatHistory(){const{data:s}=await _.get("/ai/chat/history");return s},async getChatMessages(s){const{data:a}=await _.get(`/ai/chat/${s}/messages`);return a},async deleteChat(s){const{data:a}=await _.delete(`/ai/chat/${s}`);return a},async getHealthRecommendations(s){const{data:a}=await _.get(`/ai/recommendations/${s}`);return a},async analyzeHealthData(s){const{data:a}=await _.post("/ai/analyze",s);return a}},J={class:"ai-assistant-container"},W={class:"page-header"},X={class:"header-content"},Y={class:"header-icon"},Z={class:"header-actions"},ee={class:"chat-container"},te={class:"chat-sidebar"},se={class:"chat-history"},ae=["onClick"],oe={class:"chat-icon"},ne={class:"chat-info"},ie={class:"chat-main"},le={key:0,class:"welcome-message"},re={class:"welcome-content"},ce={class:"quick-actions"},de={key:1},ue={class:"message-avatar"},me={class:"message-content"},_e={class:"message-text"},ve={class:"message-time"},pe={key:0,class:"message ai-message typing"},ge={class:"message-avatar"},he={class:"chat-input"},ye={class:"input-container"},fe={class:"input-actions"},Ce={__name:"AiAssistant",setup(s){const a=p([]),x=p([]),g=p(null),u=p(""),h=p(!1),C=p(),A=async()=>{try{const i=await D.getChatHistory();x.value=i}catch{b.error("加载对话历史失败")}},B=async i=>{try{g.value=i;const t=await D.getChatMessages(i);a.value=t,z()}catch{b.error("加载对话内容失败")}},H=()=>{g.value=null,a.value=[],u.value=""},k=async()=>{if(!u.value.trim()||h.value)return;const i=u.value.trim();u.value="";const t={id:Date.now(),message:i,is_user:!0,created_at:new Date().toISOString()};a.value.push(t),z();try{h.value=!0;const r=await D.sendMessage({message:i,chat_id:g.value}),c={id:Date.now()+1,message:r.reply,is_user:!1,created_at:r.timestamp};a.value.push(c),r.chat_id&&(g.value=r.chat_id),await A()}catch{b.error("发送消息失败，请重试")}finally{h.value=!1,z()}},M=i=>{u.value=i,k()},z=()=>{Q(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)})},I=i=>new Date(i).toLocaleDateString("zh-CN"),N=i=>new Date(i).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return q(()=>{A()}),(i,t)=>{const r=v("ChatDotRound"),c=v("el-icon"),P=v("Plus"),y=v("el-button"),T=v("User"),V=v("el-input"),R=v("Promotion");return d(),m("div",J,[e("div",W,[e("div",X,[e("div",Y,[o(c,{size:"32",color:"#409EFF"},{default:l(()=>[o(r)]),_:1})]),t[4]||(t[4]=e("div",{class:"header-text"},[e("h1",null,"智能健康助手"),e("p",null,"您的专业健康顾问，随时为您提供健康建议")],-1))]),e("div",Z,[o(y,{type:"primary",class:"new-chat-btn",onClick:H},{default:l(()=>[o(c,null,{default:l(()=>[o(P)]),_:1}),t[5]||(t[5]=f(" 新对话 ",-1))]),_:1})])]),e("div",ee,[e("div",te,[t[6]||(t[6]=e("div",{class:"sidebar-header"},[e("h3",null,"对话历史")],-1)),e("div",se,[(d(!0),m(F,null,S(x.value,n=>(d(),m("div",{key:n.id,class:E(["chat-item",{active:g.value===n.id}]),onClick:we=>B(n.id)},[e("div",oe,[o(c,{size:"16",color:"#409EFF"},{default:l(()=>[o(r)]),_:1})]),e("div",ne,[e("h4",null,w(n.title),1),e("p",null,w(I(n.last_message_time)),1)])],10,ae))),128))])]),e("div",ie,[e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:C},[a.value.length===0?(d(),m("div",le,[e("div",re,[o(c,{size:"64",color:"#409EFF"},{default:l(()=>[o(r)]),_:1}),t[10]||(t[10]=e("h3",null,"欢迎使用智能健康助手",-1)),t[11]||(t[11]=e("p",null,"我可以帮助您：",-1)),t[12]||(t[12]=e("ul",null,[e("li",null,"分析健康数据并提供建议"),e("li",null,"回答健康相关问题"),e("li",null,"提供个性化的健康指导"),e("li",null,"推荐适合的健康知识")],-1)),e("div",ce,[o(y,{type:"primary",plain:"",onClick:t[0]||(t[0]=n=>M("分析我的健康状况"))},{default:l(()=>[...t[7]||(t[7]=[f(" 分析健康状况 ",-1)])]),_:1}),o(y,{type:"primary",plain:"",onClick:t[1]||(t[1]=n=>M("如何保持健康的生活方式"))},{default:l(()=>[...t[8]||(t[8]=[f(" 健康生活建议 ",-1)])]),_:1}),o(y,{type:"primary",plain:"",onClick:t[2]||(t[2]=n=>M("解释一下血压指标"))},{default:l(()=>[...t[9]||(t[9]=[f(" 了解健康指标 ",-1)])]),_:1})])])])):(d(),m("div",de,[(d(!0),m(F,null,S(a.value,n=>(d(),m("div",{key:n.id,class:E(["message",{"user-message":n.is_user,"ai-message":!n.is_user}])},[e("div",ue,[n.is_user?(d(),$(c,{key:0,size:"24",color:"#409EFF"},{default:l(()=>[o(T)]),_:1})):(d(),$(c,{key:1,size:"24",color:"#67C23A"},{default:l(()=>[o(r)]),_:1}))]),e("div",me,[e("div",_e,w(n.message),1),e("div",ve,w(N(n.created_at)),1)])],2))),128)),h.value?(d(),m("div",pe,[e("div",ge,[o(c,{size:"24",color:"#67C23A"},{default:l(()=>[o(r)]),_:1})]),t[13]||(t[13]=e("div",{class:"message-content"},[e("div",{class:"typing-indicator"},[e("span"),e("span"),e("span")])],-1))])):K("",!0)]))],512),e("div",he,[e("div",ye,[o(V,{modelValue:u.value,"onUpdate:modelValue":t[3]||(t[3]=n=>u.value=n),type:"textarea",rows:3,placeholder:"请输入您的问题...",onKeydown:j(O(k,["ctrl"]),["enter"]),resize:"none",class:"message-input"},null,8,["modelValue","onKeydown"]),e("div",fe,[o(y,{type:"primary",onClick:k,loading:h.value,disabled:!u.value.trim(),class:"send-btn"},{default:l(()=>[o(c,null,{default:l(()=>[o(R)]),_:1}),t[14]||(t[14]=f(" 发送 ",-1))]),_:1},8,["loading","disabled"])])]),t[15]||(t[15]=e("div",{class:"input-tips"},[e("span",null,"按 Ctrl+Enter 快速发送")],-1))])])])])}}},Me=U(Ce,[["__scopeId","data-v-5b2db010"]]);export{Me as default};
