import{m as X,_ as Y,o as Z,c as g,a as y,b as a,e,w as l,r as d,g as p,E as m,i,t as C,F as ee,h as te}from"./index-Ds2Ur1i3.js";const le="http://127.0.0.1:8000/api",_=X.create({baseURL:le,timeout:1e4});_.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));_.interceptors.response.use(s=>s.data,s=>{var r;return((r=s.response)==null?void 0:r.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("username"),localStorage.removeItem("userRole"),window.location.href="/login"),Promise.reject(s)});const R={async getRecords(s={}){const{data:r}=await _.get("/health/records",{params:s});return r},async createRecord(s){const{data:r}=await _.post("/health/records",s);return r},async getRecord(s){const{data:r}=await _.get(`/health/records/${s}`);return r},async updateRecord(s,r){const{data:b}=await _.put(`/health/records/${s}`,r);return b},async deleteRecord(s){const{data:r}=await _.delete(`/health/records/${s}`);return r},async getSummary(){const{data:s}=await _.get("/health/summary");return s},async analyzeData(s={}){const{data:r}=await _.post("/health/analyze",s);return r}},ae={class:"health-data-container"},se={class:"page-header"},oe={class:"header-content"},re={class:"header-icon"},ne={class:"header-actions"},de={class:"content-section"},ue={class:"stats-grid"},ie={class:"stat-item"},ce={class:"stat-icon"},_e={class:"stat-info"},pe={class:"stat-value"},me={class:"stat-item"},he={class:"stat-icon"},ve={class:"stat-info"},fe={class:"stat-value"},ge={class:"stat-item"},ye={class:"stat-icon"},be={class:"stat-info"},we={class:"stat-value"},Ve={class:"card-header"},ke={class:"chart-placeholder"},Ce={key:0,class:"placeholder-content"},Re={key:1},De={class:"card-header"},xe={key:0,class:"analysis-result"},ze={class:"analysis-item"},Ae={key:1,class:"placeholder-content"},Se={class:"dialog-footer"},Ue={__name:"HealthData",setup(s){const r=p([]),b=p({}),A=p({}),w=p(!1),D=p(!1),S=p(!1),U=p(),n=p({weight:null,height:null,blood_pressure_systolic:null,blood_pressure_diastolic:null,heart_rate:null,blood_sugar:null,recorded_at:new Date}),$={weight:[{type:"number",message:"请输入有效的体重",trigger:"blur"}],height:[{type:"number",message:"请输入有效的身高",trigger:"blur"}],blood_pressure_systolic:[{type:"number",message:"请输入有效的收缩压",trigger:"blur"}],blood_pressure_diastolic:[{type:"number",message:"请输入有效的舒张压",trigger:"blur"}],heart_rate:[{type:"number",message:"请输入有效的心率",trigger:"blur"}],blood_sugar:[{type:"number",message:"请输入有效的血糖",trigger:"blur"}]},I=()=>{D.value=!1,n.value={weight:null,height:null,blood_pressure_systolic:null,blood_pressure_diastolic:null,heart_rate:null,blood_sugar:null,recorded_at:new Date},w.value=!0},P=u=>{D.value=!0,n.value={...u,recorded_at:new Date(u.recorded_at)},w.value=!0},H=async()=>{if(U.value)try{if(!await U.value.validate())return;S.value=!0,D.value?(await R.updateRecord(n.value.id,n.value),m.success("健康数据更新成功")):(await R.createRecord(n.value),m.success("健康数据添加成功")),w.value=!1,await z()}catch{m.error("操作失败，请重试")}finally{S.value=!1}},L=async u=>{try{await R.deleteRecord(u.id),m.success("健康数据删除成功"),await z()}catch{m.error("删除失败，请重试")}},z=async()=>{try{const[u,t]=await Promise.all([R.getRecords(),R.getSummary()]);r.value=u,b.value=t}catch{m.error("加载健康数据失败")}},N=async()=>{try{const u=await R.analyzeData();A.value=u,m.success("健康分析完成")}catch{m.error("健康分析失败")}},M=()=>{z()},T=u=>new Date(u).toLocaleString("zh-CN");return Z(()=>{z()}),(u,t)=>{const E=d("DataAnalysis"),h=d("el-icon"),j=d("Plus"),v=d("el-button"),B=d("TrendCharts"),q=d("Calendar"),G=d("Bell"),F=d("el-card"),c=d("el-col"),x=d("el-row"),V=d("el-table-column"),J=d("el-table"),k=d("el-input-number"),f=d("el-form-item"),K=d("el-date-picker"),O=d("el-form"),Q=d("el-dialog");return y(),g("div",ae,[a("div",se,[a("div",oe,[a("div",re,[e(h,{size:"32",color:"#409EFF"},{default:l(()=>[e(E)]),_:1})]),t[9]||(t[9]=a("div",{class:"header-text"},[a("h1",null,"健康数据"),a("p",null,"管理和查看您的健康数据记录")],-1))]),a("div",ne,[e(v,{type:"primary",class:"add-btn",onClick:I},{default:l(()=>[e(h,null,{default:l(()=>[e(j)]),_:1}),t[10]||(t[10]=i(" 添加数据 ",-1))]),_:1})])]),a("div",de,[e(x,{gutter:24},{default:l(()=>[e(c,{span:24},{default:l(()=>[e(F,{class:"stats-card",shadow:"hover"},{default:l(()=>[a("div",ue,[a("div",ie,[a("div",ce,[e(h,{size:"24",color:"#409EFF"},{default:l(()=>[e(B)]),_:1})]),a("div",_e,[t[12]||(t[12]=a("h3",null,"记录总数",-1)),a("p",pe,[i(C(b.value.total_records||0),1),t[11]||(t[11]=a("span",{class:"stat-unit"},"条",-1))])])]),a("div",me,[a("div",he,[e(h,{size:"24",color:"#67C23A"},{default:l(()=>[e(q)]),_:1})]),a("div",ve,[t[14]||(t[14]=a("h3",null,"本月记录",-1)),a("p",fe,[i(C(b.value.records_this_month||0),1),t[13]||(t[13]=a("span",{class:"stat-unit"},"条",-1))])])]),a("div",ge,[a("div",ye,[e(h,{size:"24",color:"#E6A23C"},{default:l(()=>[e(G)]),_:1})]),a("div",be,[t[16]||(t[16]=a("h3",null,"平均心率",-1)),a("p",we,[i(C(Math.round(b.value.average_heart_rate||0)),1),t[15]||(t[15]=a("span",{class:"stat-unit"},"bpm",-1))])])])])]),_:1})]),_:1})]),_:1}),e(x,{gutter:24,style:{"margin-top":"24px"}},{default:l(()=>[e(c,{span:16},{default:l(()=>[e(F,{class:"chart-card",shadow:"hover"},{default:l(()=>[a("div",Ve,[t[18]||(t[18]=a("h3",null,"健康趋势",-1)),e(v,{type:"text",onClick:M},{default:l(()=>[...t[17]||(t[17]=[i("刷新",-1)])]),_:1})]),a("div",ke,[r.value.length===0?(y(),g("div",Ce,[e(h,{size:"48",color:"#cbd5e1"},{default:l(()=>[e(B)]),_:1}),t[19]||(t[19]=a("p",null,"暂无数据，请添加健康记录",-1))])):(y(),g("div",Re,[e(J,{data:r.value.slice(0,5),style:{width:"100%"}},{default:l(()=>[e(V,{prop:"recorded_at",label:"记录时间",width:"180"},{default:l(o=>[i(C(T(o.row.recorded_at)),1)]),_:1}),e(V,{prop:"weight",label:"体重(kg)",width:"100"}),e(V,{prop:"blood_pressure_systolic",label:"收缩压",width:"100"}),e(V,{prop:"blood_pressure_diastolic",label:"舒张压",width:"100"}),e(V,{prop:"heart_rate",label:"心率",width:"100"}),e(V,{label:"操作"},{default:l(o=>[e(v,{type:"text",onClick:W=>P(o.row)},{default:l(()=>[...t[20]||(t[20]=[i("编辑",-1)])]),_:1},8,["onClick"]),e(v,{type:"text",style:{color:"#f56c6c"},onClick:W=>L(o.row)},{default:l(()=>[...t[21]||(t[21]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]))])]),_:1})]),_:1}),e(c,{span:8},{default:l(()=>[e(F,{class:"recent-card",shadow:"hover"},{default:l(()=>[a("div",De,[t[23]||(t[23]=a("h3",null,"数据分析",-1)),e(v,{type:"text",onClick:N},{default:l(()=>[...t[22]||(t[22]=[i("分析",-1)])]),_:1})]),A.value.recommendations?(y(),g("div",xe,[a("div",ze,[t[24]||(t[24]=a("h4",null,"健康建议",-1)),a("ul",null,[(y(!0),g(ee,null,te(A.value.recommendations,o=>(y(),g("li",{key:o},C(o),1))),128))])])])):(y(),g("div",Ae,[e(h,{size:"48",color:"#cbd5e1"},{default:l(()=>[e(E)]),_:1}),t[25]||(t[25]=a("p",null,"点击分析获取健康建议",-1))]))]),_:1})]),_:1})]),_:1})]),e(Q,{modelValue:w.value,"onUpdate:modelValue":t[8]||(t[8]=o=>w.value=o),title:D.value?"编辑健康数据":"添加健康数据",width:"600px"},{footer:l(()=>[a("span",Se,[e(v,{onClick:t[7]||(t[7]=o=>w.value=!1)},{default:l(()=>[...t[26]||(t[26]=[i("取消",-1)])]),_:1}),e(v,{type:"primary",onClick:H,loading:S.value},{default:l(()=>[i(C(D.value?"更新":"保存"),1)]),_:1},8,["loading"])])]),default:l(()=>[e(O,{model:n.value,rules:$,ref_key:"healthFormRef",ref:U,"label-width":"120px"},{default:l(()=>[e(x,{gutter:16},{default:l(()=>[e(c,{span:12},{default:l(()=>[e(f,{label:"体重(kg)",prop:"weight"},{default:l(()=>[e(k,{modelValue:n.value.weight,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value.weight=o),precision:1,step:.1,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:l(()=>[e(f,{label:"身高(cm)",prop:"height"},{default:l(()=>[e(k,{modelValue:n.value.height,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.height=o),precision:1,step:.1,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:16},{default:l(()=>[e(c,{span:12},{default:l(()=>[e(f,{label:"收缩压",prop:"blood_pressure_systolic"},{default:l(()=>[e(k,{modelValue:n.value.blood_pressure_systolic,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.blood_pressure_systolic=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:l(()=>[e(f,{label:"舒张压",prop:"blood_pressure_diastolic"},{default:l(()=>[e(k,{modelValue:n.value.blood_pressure_diastolic,"onUpdate:modelValue":t[3]||(t[3]=o=>n.value.blood_pressure_diastolic=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:16},{default:l(()=>[e(c,{span:12},{default:l(()=>[e(f,{label:"心率",prop:"heart_rate"},{default:l(()=>[e(k,{modelValue:n.value.heart_rate,"onUpdate:modelValue":t[4]||(t[4]=o=>n.value.heart_rate=o),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:l(()=>[e(f,{label:"血糖",prop:"blood_sugar"},{default:l(()=>[e(k,{modelValue:n.value.blood_sugar,"onUpdate:modelValue":t[5]||(t[5]=o=>n.value.blood_sugar=o),precision:1,step:.1,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{label:"记录时间",prop:"recorded_at"},{default:l(()=>[e(K,{modelValue:n.value.recorded_at,"onUpdate:modelValue":t[6]||(t[6]=o=>n.value.recorded_at=o),type:"datetime",placeholder:"选择日期时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ee=Y(Ue,[["__scopeId","data-v-8b674453"]]);export{Ee as default};
